"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const common_1 = require("bdsx/common");
const event_1 = require("bdsx/event");
const utils_1 = require("../../../utils/utils");
const region_form_1 = require("./../region/region_form");
const database = new utils_1.Utils.Database();
const root = new utils_1.Utils.Root();
event_1.events.chestOpen.on(ev => {
    const player = ev.player;
    const ni = player.getNetworkIdentifier();
    const block_position = ev.blockPos;
    const x = Math.ceil(block_position.x / 8);
    const z = Math.ceil(block_position.z / 8);
    const area_territory = new utils_1.AreaTerritory(ni);
    const area_json = `${x}_${z}.json`;
    if (database.exist_file(root.DATABASE_AREA, area_json)) {
        const data = database.load(root.DATABASE_AREA, area_json);
        if (player.getNameTag() !== data._player_name) {
            return common_1.CANCEL; //남땅이면 CANCEL
        }
    }
    else {
        if (region_form_1.map[player.getNameTag()] == true)
            return common_1.CANCEL; //내땅아니면 CANCEL(조건)
    }
});
event_1.events.blockDestroy.on(ev => {
    const player = ev.player;
    const ni = player.getNetworkIdentifier();
    const block_position = ev.blockPos;
    const x = Math.ceil(block_position.x / 8);
    const z = Math.ceil(block_position.z / 8);
    const area_territory = new utils_1.AreaTerritory(ni);
    const area_json = `${x}_${z}.json`;
    if (database.exist_file(root.DATABASE_AREA, area_json)) {
        const data = database.load(root.DATABASE_AREA, area_json);
        if (player.getNameTag() !== data._player_name) {
            return common_1.CANCEL;
        }
    }
    else {
        if (region_form_1.map[player.getNameTag()] == true)
            return common_1.CANCEL; //내땅아니면 CANCEL(조건)
    }
});
event_1.events.blockPlace.on(ev => {
    const player = ev.player;
    const ni = player.getNetworkIdentifier();
    const block_position = ev.blockPos;
    const x = Math.ceil(block_position.x / 8);
    const z = Math.ceil(block_position.z / 8);
    const area_territory = new utils_1.AreaTerritory(ni);
    const area_json = `${x}_${z}.json`;
    if (database.exist_file(root.DATABASE_AREA, area_json)) {
        const data = database.load(root.DATABASE_AREA, area_json);
        if (player.getNameTag() !== data._player_name) {
            return common_1.CANCEL;
        }
    }
    else {
        if (region_form_1.map[player.getNameTag()] == true)
            return common_1.CANCEL; //내땅아니면 CANCEL(조건)
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXZlbnRzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZXZlbnRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsd0NBQXFDO0FBQ3JDLHNDQUFvQztBQUNwQyxnREFBNEQ7QUFDNUQseURBQThDO0FBRTlDLE1BQU0sUUFBUSxHQUFHLElBQUksYUFBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO0FBQ3RDLE1BQU0sSUFBSSxHQUFHLElBQUksYUFBSyxDQUFDLElBQUksRUFBRSxDQUFDO0FBRTlCLGNBQU0sQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFO0lBQ3JCLE1BQU0sTUFBTSxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUM7SUFDekIsTUFBTSxFQUFFLEdBQUcsTUFBTSxDQUFDLG9CQUFvQixFQUFFLENBQUM7SUFDekMsTUFBTSxjQUFjLEdBQUcsRUFBRSxDQUFDLFFBQVEsQ0FBQztJQUNuQyxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDMUMsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQzFDLE1BQU0sY0FBYyxHQUFHLElBQUkscUJBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUM3QyxNQUFNLFNBQVMsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQztJQUNuQyxJQUFJLFFBQVEsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxTQUFTLENBQUMsRUFBRTtRQUNwRCxNQUFNLElBQUksR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDMUQsSUFBSSxNQUFNLENBQUMsVUFBVSxFQUFFLEtBQUssSUFBSSxDQUFDLFlBQVksRUFBRTtZQUMzQyxPQUFPLGVBQU0s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